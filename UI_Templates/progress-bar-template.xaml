<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="{Binding WindowTitle, FallbackValue='Syncing Skills...'}"
    Width="560" Height="480"
    MinWidth="440" MinHeight="380"
    WindowStartupLocation="CenterOwner"
    ResizeMode="CanResizeWithGrip"
    Background="#1B2838">

    <Window.Resources>
        <!-- ===== Color Palette: Submarine / Harry Potter Fusion ===== -->
        <SolidColorBrush x:Key="DeepNavyBrush" Color="#1B2838"/>
        <SolidColorBrush x:Key="GoldAccentBrush" Color="#C9A94E"/>
        <SolidColorBrush x:Key="DarkTealBrush" Color="#1A3C40"/>
        <SolidColorBrush x:Key="ParchmentBrush" Color="#F5E6C8"/>
        <SolidColorBrush x:Key="GoldHoverBrush" Color="#D4B95F"/>
        <SolidColorBrush x:Key="NavyLightBrush" Color="#263A4F"/>
        <SolidColorBrush x:Key="StatusBarBrush" Color="#0F1A24"/>
        <SolidColorBrush x:Key="DimTextBrush" Color="#8899AA"/>
        <SolidColorBrush x:Key="BorderGoldBrush" Color="#8B7435"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#C0392B"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#27AE60"/>

        <!-- ===== Typography ===== -->
        <Style x:Key="HeadingStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource GoldAccentBrush}"/>
        </Style>

        <Style x:Key="BodyTextStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{StaticResource ParchmentBrush}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <Style x:Key="DimTextStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource DimTextBrush}"/>
        </Style>

        <!-- ===== Themed Progress Bar: Gold fill on dark teal track ===== -->
        <Style x:Key="ThemedProgressBar" TargetType="ProgressBar">
            <Setter Property="Height" Value="22"/>
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="100"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid>
                            <!-- Track (dark teal background) -->
                            <Border x:Name="PART_Track"
                                    Background="{StaticResource DarkTealBrush}"
                                    BorderBrush="{StaticResource BorderGoldBrush}"
                                    BorderThickness="1"
                                    CornerRadius="3"/>
                            <!-- Fill (gold) -->
                            <Border x:Name="PART_Indicator"
                                    HorizontalAlignment="Left"
                                    CornerRadius="3">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#A88A3E" Offset="0"/>
                                        <GradientStop Color="#C9A94E" Offset="0.5"/>
                                        <GradientStop Color="#D4B95F" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Primary Button (Accept) ===== -->
        <Style x:Key="AcceptButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource DeepNavyBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource GoldAccentBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Padding" Value="20,8"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGoldBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="BtnBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="{StaticResource DarkTealBrush}"/>
                                <Setter TargetName="BtnBorder" Property="BorderBrush" Value="{StaticResource GoldAccentBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource GoldHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="#0D1F2D"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="BtnBorder" Property="Opacity" Value="0.45"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Cancel Button ===== -->
        <Style x:Key="CancelButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource DimTextBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Padding" Value="20,8"/>
            <Setter Property="BorderBrush" Value="#3A4A5A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="BtnBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="{StaticResource NavyLightBrush}"/>
                                <Setter TargetName="BtnBorder" Property="BorderBrush" Value="{StaticResource DimTextBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ParchmentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="#1A2A3A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== File Change List Item ===== -->
        <Style x:Key="FileChangeItemStyle" TargetType="ListViewItem">
            <Setter Property="Foreground" Value="{StaticResource ParchmentBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="ItemBorder"
                                Background="Transparent"
                                Padding="{TemplateBinding Padding}"
                                BorderThickness="0,0,0,1"
                                BorderBrush="#1E3040">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="{StaticResource NavyLightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="{StaticResource DarkTealBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- ===== Window Border / Chrome ===== -->
    <Border BorderBrush="{StaticResource BorderGoldBrush}" BorderThickness="1">
        <DockPanel LastChildFill="True">

            <!-- ===== Header ===== -->
            <Border DockPanel.Dock="Top"
                    Background="{StaticResource StatusBarBrush}"
                    BorderBrush="{StaticResource BorderGoldBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="20,14">
                <TextBlock Text="{Binding HeaderText, FallbackValue='Sync Progress'}"
                           Style="{StaticResource HeadingStyle}"/>
            </Border>

            <!-- ===== Button Bar (Bottom) ===== -->
            <Border DockPanel.Dock="Bottom"
                    Background="{StaticResource StatusBarBrush}"
                    BorderBrush="{StaticResource BorderGoldBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="20,12">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Right"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <Button Content="Cancel"
                                Style="{StaticResource CancelButtonStyle}"
                                Command="{Binding CancelCommand}"
                                Margin="0,0,10,0"/>
                        <Button Content="Accept"
                                Style="{StaticResource AcceptButtonStyle}"
                                Command="{Binding AcceptCommand}"
                                IsEnabled="{Binding IsComplete}"/>
                    </StackPanel>
                    <TextBlock Style="{StaticResource DimTextStyle}"
                               VerticalAlignment="Center"
                               Text="{Binding ElapsedText, FallbackValue=''}"/>
                </DockPanel>
            </Border>

            <!-- ===== Main Content ===== -->
            <StackPanel Margin="20,16,20,0">

                <!-- Current File -->
                <TextBlock Style="{StaticResource BodyTextStyle}"
                           Margin="0,0,0,4">
                    <Run Text="Current file: "/>
                    <Run Text="{Binding CurrentFileName, FallbackValue='waiting...'}"
                         Foreground="{StaticResource GoldAccentBrush}"
                         FontWeight="Medium"/>
                </TextBlock>

                <!-- Progress Bar -->
                <Grid Margin="0,4,0,2">
                    <ProgressBar Style="{StaticResource ThemedProgressBar}"
                                 Value="{Binding ProgressPercent, FallbackValue=0}">
                        <ProgressBar.Triggers>
                            <EventTrigger RoutedEvent="Binding.TargetUpdated">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Value"
                                                         Duration="0:0:0.3"
                                                         To="{Binding ProgressPercent}"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </ProgressBar.Triggers>
                    </ProgressBar>
                    <!-- Percentage Overlay -->
                    <TextBlock HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontFamily="Segoe UI"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ParchmentBrush}">
                        <Run Text="{Binding ProgressPercent, StringFormat={}{0:0}, FallbackValue=0}"/>
                        <Run Text="%"/>
                    </TextBlock>
                </Grid>

                <!-- Status Text -->
                <TextBlock Style="{StaticResource DimTextStyle}"
                           Margin="0,4,0,16"
                           Text="{Binding StatusText, FallbackValue='Preparing to sync...'}"/>

                <!-- File Changes Preview Header -->
                <DockPanel Margin="0,0,0,6">
                    <TextBlock DockPanel.Dock="Right"
                               Style="{StaticResource DimTextStyle}"
                               Text="{Binding FileCountText, FallbackValue='0 files'}"/>
                    <TextBlock Text="File Changes"
                               FontFamily="Segoe UI"
                               FontSize="14"
                               FontWeight="Medium"
                               Foreground="{StaticResource ParchmentBrush}"/>
                </DockPanel>

                <!-- File Change List -->
                <ListView x:Name="FileChangesList"
                          Background="{StaticResource NavyLightBrush}"
                          BorderBrush="{StaticResource BorderGoldBrush}"
                          BorderThickness="1"
                          ItemContainerStyle="{StaticResource FileChangeItemStyle}"
                          ItemsSource="{Binding FileChanges}"
                          MinHeight="120"
                          MaxHeight="250"
                          ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <DockPanel>
                                <!-- Status indicator -->
                                <Border DockPanel.Dock="Left"
                                        Width="8" Height="8"
                                        CornerRadius="4"
                                        Margin="0,0,10,0"
                                        VerticalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource DimTextBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ChangeType}" Value="Added">
                                                    <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding ChangeType}" Value="Modified">
                                                    <Setter Property="Background" Value="{StaticResource GoldAccentBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding ChangeType}" Value="Deleted">
                                                    <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                                <!-- Change type label -->
                                <TextBlock DockPanel.Dock="Right"
                                           Text="{Binding ChangeType}"
                                           Foreground="{StaticResource DimTextBrush}"
                                           FontSize="11"
                                           VerticalAlignment="Center"
                                           Margin="10,0,0,0"/>
                                <!-- File path -->
                                <TextBlock Text="{Binding FilePath}"
                                           Foreground="{StaticResource ParchmentBrush}"
                                           FontSize="12"
                                           TextTrimming="CharacterEllipsis"
                                           VerticalAlignment="Center"/>
                            </DockPanel>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

            </StackPanel>
        </DockPanel>
    </Border>
</Window>
